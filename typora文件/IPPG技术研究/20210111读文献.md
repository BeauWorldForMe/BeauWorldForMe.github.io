## 基于iPPG的人体生理参数测量中的信号增强方法研究

信号微弱，容易受到各种因素的影响。

关于iPPG信号**影响因素的研究**仍处于起步阶段。

iPPG信号增强方法的研究可以有效提高采集模块的可用性，从而提高获得的生理参数的准确性。本文从三个角度研究此问题：信号获取方法，外部影响和信号处理。



## 信噪比

SNR是在处理iPPG信号之前估算的。计算方法如下：SNR = Ps / Pn（1）原始iPPG信号的每个片段都经过相同数量的快速傅里叶变换。  Ps是介于0.7-4 Hz之间的振幅频谱值之和，而Pn是介于0.7-4  Hz以外的频率范围内的振幅频谱值的总和。通过每个视频的SNR值，总结每个影响因素是否对iPPG信号有影响，以及它有什么影响。

### 信号获取方法

优化和改善视频人脸检测和人脸跟踪。本文使用了Camshift跟踪算法和AdaBoost人脸检测算法的兼容方法来提高检测视频人脸的能力，并使用一种改进的Camshift跟踪算法-ERC（环境鲁棒Camshift）进行人脸跟踪和ROI区域划分。



Viola-Jones算法是iPPG技术中最常用的面部检测方法[1-5]，它使用类似Harr的特征描述面部的共同属性，然后通过Adaboost算法构建级联分类器。

AdaBoost算法,由Yoav Freund和Robert Schapire在1995年提出。AdaBoost算法的全名是：Adaptive  Boosting（自适应增强算法）。该算法的核心是使用相同的弱分类器对不同样本集进行训练，以获得多个弱分类器。错误检测率会计算每个弱分类器的置信度。置信度用作算法中弱分类器的权重。最后，将每个弱分类器的检测结果乘以这些权重进行分类。但是，在实际应用中，除了要检测的人体部位之外，相机还捕获了一些不规则的背景。被检测部位的成像尺寸和角度也会随着人体的晃动而变化。这些问题将降低信号的SNR，因此有必要处理视频以获取被检测部分的图像。但是，**简单的AdaBoost算法缺乏鲁棒性**，这导致了一种有效的检测方法。Shen Mengye[6]提出了一种**结合Camshift跟踪算法和AdaBoost人脸检测算法的方法**，以增强AdaBoost检测算法在视频人脸检测中的鲁棒性。这**提高了检测视频中人脸的能力**，并为获得理想的iPPG信号提供了基础。

+ Camshift跟踪算法（cv）
  + 基础--meanshift
    + 均值漂移算法，一个迭代过程：
      + 先算出当前点的偏移均值，将该点移动到此偏移均值，然后以此为新的起始点，继续移动，直到满足最终的条件。
    + 1.在ROI内计算偏移均值<img src="https://img-blog.csdnimg.cn/20190306175736777.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3Nzc1OTkw,size_16,color_FFFFFF,t_70" alt="img" style="zoom:50%;" />
    + 2.移动ROI圆心点到偏移均值点处(重心)<img src="https://img-blog.csdnimg.cn/20190306175752457.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3Nzc1OTkw,size_16,color_FFFFFF,t_70" alt="img" style="zoom:50%;" />
    + 3.重复上述的过程(计算新的偏移均值，移动)<img src="https://img-blog.csdnimg.cn/2019030617580474.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3Nzc1OTkw,size_16,color_FFFFFF,t_70" alt="img" style="zoom:50%;" />
    + 经过几次迭代，可以使圆的中心和小球密度最大的点(重心)重合，不再移动。
    + meanshift应用在实际目标追踪上的话和上图过程有一些区别，但是原理是类似的。图像的像素点是横平竖直排列的，像素点之间的距离相同，上图的小球是疏密相间彼此间的距离不一样；图像的像素点各自的值也不一样，上图的小球各自的“重量”默认相等。原理上都是搜索圆心向“重心”移动，在上图中搜索圆的圆心是向小球最多最密的地方移动，在图像中，将图像看成二维的重量分布不均匀的薄木板，搜索圆心向薄木板的“重心”移动。
+ **应用RGB直方图均衡化，以扩展像素之间的色调差异。**该算法可以有效地跟踪在强烈光照变化，复杂背景和快速运动下的人脸。

### 外部影响

光强度，光色，肤色，年龄和性别。本文使用控制变量法和Bland-Altman分析方法来计算并比较每个iPPG信号的SNR。

**结果表明，光强度和年龄对iPPG信号的信噪比没有影响。**绿光具有最佳的SNR，其次是白光，蓝光和红光。

**肤色的影响**：男性的第二，第三和第四种皮肤颜色分别为1.151、0.765、0.541，女性为0.812、0.623、0.318，**这意味着随着皮肤颜色的加深，SNR会降低。**

关于肤色：选择100 * 100像素的人脸同一区域，然后将该区域的三个RGB通道的平均值相加，得到一个值，将其命名为肤色值。一级肤色的肤色值：507〜675；第二级肤色的肤色值：338〜506；第三级肤色的肤色值：169〜337;第四级肤色的肤色值：0〜168



### 信号处理

本文研究了小波变换和欧拉视频放大技术两种增强信号的方法。本文中使用的Euler视频放大技术从图像开始，该图像放大了所需信号的频率，并且自然实现了信号增强。

**来使iPPG信号的时域形状与脉冲波更加一致，并提高SNR**

+ 欧拉视频放大技术**（值得使用）**

  + 弗里曼说，当**人们吸气时，血液会从心脏流到脸部**

  + 欧拉视频放大技术的实质是逐帧改变视频剪辑的像素以显示细微的颜色变化，同时放大这些颜色。

  + 流程

    + 视频序列的金字塔多分辨率分解，以获得不同空间频率的基带。由于空间滤波的目的仅仅是将多个相邻像素“拼凑”为一块，因此可以使用低通滤波器来执行。

    #### 拉格朗日视角

    所谓拉格朗日视角，就是从跟踪图像中感兴趣的像素（粒子）的运动轨迹的角度着手分析。打个比方，假如我们要研究河水的流速，我们坐上一条船，顺流而下，然后记录这条船的运动轨迹。

    #### 欧拉视角

    不同于拉格朗日视角，欧拉视角并不显式地跟踪和估计粒子的运动，而是将视角固定在一个地方，例如整幅图像。之后，假定**整幅图像都在变**，只是这些变化信号的频率、振幅等特性不同，而我们所感兴趣的变化信号就身处其中。这样，对“变”的放大就变成了对感兴趣频段的析出和增强。打个比方，同样是研究河水的流速，我们也可以坐在岸边，观察河水经过一个固定的地方时的变化，这个变化可能包含很多和水流本身无关的成分，比如叶子掉下水面激起的涟漪，但我们只关注最能体现水流速的部分。

    



